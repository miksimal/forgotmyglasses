{"version":3,"sources":["App.tsx","serviceWorker.ts","index.tsx"],"names":["AWS","config","region","credentials","CognitoIdentityCredentials","IdentityPoolId","rekog","Rekognition","App","useState","trainingUploadIsLoading","setTrainingUploadIsLoading","friendCheckerUploadIsLoading","setFriendCheckerUploadIsLoading","uuidv4","collectionId","setCollectionId","aboutToStart","setAboutToStart","trainingTheRobot","setTrainingTheRobot","robotIsReady","setRobotIsReady","facesInCollectionCount","setFacesInCollectionCount","a","params","CollectionId","createCollection","promise","console","log","message","readFileAsync","file","Promise","resolve","reject","reader","FileReader","onload","result","onerror","readAsArrayBuffer","indexFace","buffer","Error","Image","Bytes","indexFaces","FaceRecords","length","window","alert","document","getElementById","value","e","files","target","Blob","MaxFaces","searchFacesByImage","FaceMatches","similarity","Similarity","className","Button","size","onClick","id","onChange","type","accept","capture","Spinner","animation","click","onDragEnter","stopPropagation","preventDefault","onDragOver","onDrop","dataTransfer","startsWith","indexFaceBasedOnDropEvent","color","icon","faPlus","Boolean","location","hostname","match","ReactDOM","render","StrictMode","navigator","serviceWorker","ready","then","registration","unregister","catch","error"],"mappings":"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","file":"static/js/main.72c3f580.chunk.js","sourcesContent":["/// <reference types=\"aws-sdk\" />\n\nimport React, { useState, ChangeEvent, } from \"react\";\nimport './App.css';\nimport { v4 as uuidv4 } from 'uuid';\nimport AWS from 'aws-sdk';\nimport Rekognition, { CreateCollectionRequest, IndexFacesRequest, SearchFacesByImageRequest } from \"aws-sdk/clients/rekognition\";\nimport Button from 'react-bootstrap/Button';\nimport Spinner from 'react-bootstrap/Spinner';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faPlus } from '@fortawesome/free-solid-svg-icons'\n\nAWS.config.region = 'eu-west-1';\nAWS.config.credentials = new AWS.CognitoIdentityCredentials({\n    IdentityPoolId: 'eu-west-1:4a8f8cca-1fe0-4ce5-843c-3118a21061f6',\n});\nconst rekog: AWS.Rekognition = new AWS.Rekognition();\n\nfunction App() {\n  const [trainingUploadIsLoading, setTrainingUploadIsLoading] = useState(false);\n  const [friendCheckerUploadIsLoading, setFriendCheckerUploadIsLoading] = useState(false);\n  const [collectionId, setCollectionId] = useState<string>(uuidv4());\n  const [aboutToStart, setAboutToStart] = useState(true);\n  const [trainingTheRobot, setTrainingTheRobot] = useState(false);\n  const [robotIsReady, setRobotIsReady] = useState(false);\n  const [facesInCollectionCount, setFacesInCollectionCount] = useState(0);\n\n  async function createCollection() {\n    try {\n      const params: CreateCollectionRequest = {\n        CollectionId: collectionId\n       };\n      await rekog.createCollection(params).promise();\n      setCollectionId(collectionId);\n      setAboutToStart(false);\n      setTrainingTheRobot(true);\n    } catch (e) {\n      console.log(e.message);\n    }\n  }\n\n  function readFileAsync(file: Blob): Promise<string | ArrayBuffer | null> {\n    return new Promise((resolve, reject) => {\n      let reader: FileReader = new FileReader();\n  \n      reader.onload = () => {\n        resolve(reader.result);\n      };\n  \n      reader.onerror = reject;\n  \n      reader.readAsArrayBuffer(file);\n      // thanks https://simon-schraeder.de/posts/filereader-async/\n    })\n  }\n\n  async function indexFace(file: Blob) {\n    setTrainingUploadIsLoading(true);\n    try {\n      const buffer = await readFileAsync(file);\n      if (buffer == null) throw new Error('Error reading file');\n\n      const params: IndexFacesRequest = {\n        CollectionId: collectionId,\n        Image: {\n          Bytes: buffer\n        }\n      };\n      const result: Rekognition.IndexFacesResponse  = await rekog.indexFaces(params).promise();\n      if (result.FaceRecords && result.FaceRecords.length === 0) {\n        window.alert('Woops, no face was registered in that photo. Can you try a different one?');\n      } else {\n        setRobotIsReady(true);\n        setFacesInCollectionCount(facesInCollectionCount + 1);\n        ((document.getElementById(\"uploadTrainingPhoto\")) as HTMLInputElement).value = \"\";\n      }\n    } catch (e) {\n      console.log(e.message);\n    }\n    setTrainingUploadIsLoading(false);\n  }\n\n  async function searchFace(e: ChangeEvent<HTMLInputElement>) {\n    const files = e.target.files ? e.target.files : [new Blob()];\n    setFriendCheckerUploadIsLoading(true);\n    try {\n      const buffer = await readFileAsync(files[0]);\n      if (buffer == null) throw new Error('Error reading file');\n\n      const params: SearchFacesByImageRequest = {\n        CollectionId: collectionId,\n        Image: {\n          Bytes: buffer\n        },\n        MaxFaces: 1,\n      };\n      const result: Rekognition.SearchFacesByImageResponse  = await rekog.searchFacesByImage(params).promise();\n      if (!result.FaceMatches) return;\n      if (result.FaceMatches?.length == 0) {\n        window.alert('This is definitely not your friend. Abort!')\n        setFriendCheckerUploadIsLoading(false);\n        ((document.getElementById(\"uploadFriendPhoto\")) as HTMLInputElement).value = \"\";\n        return;\n      }\n      if (result.FaceMatches[0]) {\n        const similarity = result.FaceMatches[0].Similarity;\n        if (!similarity) return;\n        let message: string;\n        switch (true) {\n          case (similarity < 50):\n            message = 'This is probably not your friend (less than 50% similarity)';\n            break;\n          case (similarity < 75):\n            message = 'This could be, but probably is not, your friend (less than 75% similarity) - worth a go?'\n            break;\n          case (similarity < 90):\n            message = 'This is probably your friend (greater than 75% similarity)! Say hello!'\n            break;\n          case (similarity < 99.5):\n            message = 'This is almost certainly your friend (greater than 90% similarity)! Say hello!'\n            break;\n          case (similarity <= 100):\n            message = 'This is DEFINITELY your friend (100% similarity score)!'\n            break;\n          default:\n            message = 'Something went wrong, sorry!';\n        }\n        window.alert(message);\n        ((document.getElementById(\"uploadFriendPhoto\")) as HTMLInputElement).value = \"\";\n      }\n    } catch (e) {\n      console.log(e.message);\n      setFriendCheckerUploadIsLoading(false);\n      ((document.getElementById(\"uploadFriendPhoto\")) as HTMLInputElement).value = \"\";\n    }\n  }\n\n  function renderHeadingForTrainingPhotoUpload() {\n    if (facesInCollectionCount === 0) {\n      return <><h2>Provide a photo of at least one friend.</h2><p>A photo may contain up to 100 faces.</p></>\n    }\n    else if (facesInCollectionCount > 0 && facesInCollectionCount < 2) {\n      return <h2>One photo added üéâ You can now try the friend-checker below or add more photos.</h2>\n    }\n    else {\n      return <h2>{facesInCollectionCount} photos added üéâ You can now try the friend-checker below or add more photos.</h2>\n    }\n  }\n\n  function indexFaceBasedOnDropEvent(e: React.DragEvent<HTMLDivElement>) {\n    const files = e.dataTransfer.files;\n    if (files.length > 1) {\n      window.alert(\"Sorry, only one image at at time please\");\n      return;\n    }\n    const file = files[0];\n    if (!file.type.startsWith(\"image\")) {\n      window.alert(\"File must be an image\");\n      return;\n    }\n    indexFace(file);\n  }\n\n  function renderTrainingPhotoUpload() {\n    return (\n      <div>\n        {renderHeadingForTrainingPhotoUpload()}\n        <input id=\"uploadTrainingPhoto\" onChange={(e) => {const file = e.target.files ? e.target.files[0] : new Blob(); indexFace(file)}} type=\"file\" accept=\"image/*\" capture=\"camera\"></input>\n        {trainingUploadIsLoading ? <Spinner animation=\"border\"></Spinner> :\n          <div \n            id=\"dropbox\"\n            onClick={() => ((document.getElementById(\"uploadTrainingPhoto\")) as HTMLInputElement).click()}\n            onDragEnter={(e) => {e.stopPropagation(); e.preventDefault();}}\n            onDragOver={(e) => {e.stopPropagation(); e.preventDefault();}}\n            onDrop={(e) => {e.stopPropagation(); e.preventDefault(); indexFaceBasedOnDropEvent(e);}}\n          >\n            <FontAwesomeIcon className=\"PlusIcon\" color={\"#61dafb\"} icon={faPlus} size={\"3x\"} />\n            <div className=\"TextWithinUploadBox\">\n              <span>Drag & drop</span>\n              <span>or click to upload</span>\n            </div>\n          </div>\n        }\n\n      </div>\n    )\n  }\n  // Styling TODO:\n  // add spinners for loading states. Done.\n  // nicer looking photo inputs https://medium.com/better-programming/handling-file-inputs-with-javascript-9f2d3a007f05 ; https://tympanus.net/codrops/2015/09/15/styling-customizing-file-inputs-smart-way/ - make nicer looking drop areas and filepicker\n  // add nicer modal or other way to provide the results instead of window alert?\n  // simple favicon that's not the react one :)\n  // fix ugly grey in subheading\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <h2>\n          Ever forget your glasses and fail to recognise a friend?\n        </h2>\n        <h4>\n          Keep calm and use this robot to help you üëÄ\n        </h4>\n        <ul>\n            <li>\n              <b>Teach the robot</b> by uploading photos of your friends üç∞\n            </li>\n            <li>\n              <b>Ask the robot if someone is your friend</b> by quickly snapping a photo üì∏\n            </li>\n          </ul>\n      </header>\n      <body>\n        {aboutToStart &&\n          <div>\n            <Button size=\"lg\" onClick={createCollection}>Amazing, let's do it! üî•</Button>\n          </div>\n        }\n        {trainingTheRobot && renderTrainingPhotoUpload()}\n        {robotIsReady &&\n          <div className=\"FriendChecker\">\n            <h2>Friend-checker. Snap a photo of your 'friend' and I'll tell you if it's your friend</h2>\n            <p>If more than one person is present in the photo, the largest face will be used for the comparison</p>\n            {friendCheckerUploadIsLoading ? <Spinner animation=\"border\"></Spinner> :\n              <input id=\"uploadFriendPhoto\" onChange={searchFace} type=\"file\" accept=\"image/*\" capture=\"camera\"></input>\n            }\n          </div>\n        }\n        {!aboutToStart && <p className=\"Disclaimer\">Note: I do not store your photos. Facial features from the training photos are extracted and stored for a maximum of 24 hours. Your data will be used only by you. Nothing is stored from photos uploaded for friend-checking.</p>}\n      </body>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}